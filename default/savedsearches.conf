
############################################################
#	Simple search used in Home page to show
#	numbers of hosts indexed within last 7 days
############################################################

[Hosts with data within last 7 days]
dispatch.earliest_time = -7d@h
dispatch.latest_time = now
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.singlevalue.colorBy = trend
display.visualizations.singlevalue.rangeColors = ["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]
display.visualizations.singlevalue.rangeValues = [0,30,70,100]
display.visualizations.singlevalue.trendInterval = auto
display.visualizations.singlevalue.underLabel = Hosts with recent activity
display.visualizations.singlevalue.useColors = 1
display.visualizations.singlevalueHeight = 173
display.visualizations.type = singlevalue
search = | pivot NMON_Config Nmon_Config dc(hostname) AS "dcount" SPLITROW _time AS _time PERIOD day SORT 0 _time ROWSUMMARY 0 COLSUMMARY 0 NUMCOLS 0 SHOWOTHER 1

#############################################################
# Indexing Volume
#############################################################

[Volume of Data indexed Today]
alert.digest_mode = 1
auto_summarize.dispatch.earliest_time = -7d@d
dispatch.earliest_time = -7d@h
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.singlevalue.afterLabel = MB indexed
display.visualizations.singlevalue.colorBy = trend
display.visualizations.singlevalue.numberPrecision = 0.00
display.visualizations.singlevalue.rangeColors = ["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]
display.visualizations.singlevalue.rangeValues = [0,30,70,100]
display.visualizations.singlevalue.trendColorInterpretation = inverse
display.visualizations.singlevalue.trendDisplayMode = percent
display.visualizations.singlevalue.trendInterval = -24h
display.visualizations.singlevalue.underLabel = Today Incoming Data Volume
display.visualizations.singlevalue.useColors = 1
display.visualizations.type = singlevalue
search = index=_internal source=*license_usage.log* type=Usage idx=nmon | timechart span=1d sum(b) AS volume | fillnull value=0 | eval volume=(volume/1024/1024)

#############################################################
# NMON Inventory
#############################################################

# This report will generate the inventory lookup table used in many interfaces of the App.
# We arbitrary only keep one result per day and per host of the nmon_config sourcetype, then we keep the last value by field in case of multiple values found, typically an hardware configuration
# change

[Generate NMON Inventory Lookup Table]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.digest_mode = True
alert.suppress = 0
alert.track = 0
auto_summarize = 0
auto_summarize.dispatch.earliest_time =
cron_schedule = 0 * * * *
description = Generation of NMON Inventory Lookup Table
dispatch.earliest_time =
dispatch.latest_time = now
dispatch.ttl = 3600 # Keep 1 hour this job artifact
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.general.type = statistics
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
enableSched = 1
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 15
search = | tstats latest("Nmon_Config.AIX_Machine_SerialNumber") AS AIX_Machine_SerialNumber\
latest("Nmon_Config.AIX_virtualcpus") AS AIX_virtualcpus\
latest("Nmon_Config.AIX_logicalcores") AS AIX_logicalcores\
latest("Nmon_Config.AIX_entitled") AS AIX_entitled\
latest("Nmon_Config.AIX_LEVEL") AS AIX_LEVEL\
latest("Nmon_Config.AIX_processor_mode") AS AIX_processor_mode\
latest("Nmon_Config.AIX_processor_clockspeed") AS AIX_processor_clockspeed\
latest("Nmon_Config.AIX_cpu_type") AS AIX_cpu_type\
latest("Nmon_Config.AIX_kernel_type") AS AIX_kernel_type\
latest("Nmon_Config.AIX_plateform_firmware_level") AS AIX_plateform_firmware_level\
latest("Nmon_Config.AIX_PoolID") AS AIX_PoolID\
latest("Nmon_Config.AIX_system_installed_CPUs") AS AIX_system_installed_CPUs\
latest("Nmon_Config.AIX_system_active_CPUs") AS AIX_system_active_CPUs\
latest("Nmon_Config.AIX_PoolCPUs") AS AIX_PoolCPUs\
latest("Nmon_Config.Linux_memory_MB") AS Linux_memory_MB\
latest("Nmon_Config.Linux_swap_MB") AS Linux_swap_MB\
latest("Nmon_Config.Linux_distribution") AS Linux_distribution\
latest("Nmon_Config.Linux_vendor") AS Linux_vendor\
latest("Nmon_Config.Linux_kernelversion") AS Linux_kernelversion\
latest("Nmon_Config.Solaris_version") AS Solaris_version\
latest("Nmon_Config.Solaris_sunOS_version") AS Solaris_sunOS_version\
latest("Nmon_Config.Solaris_processor_clockspeed") AS Solaris_processor_clockspeed\
latest("Nmon_Config.Processor") AS Processor\
latest("Nmon_Config.cpu_cores") AS cpu_cores\
latest("Nmon_Config.nmon_version") AS nmon_version\
latest("Nmon_Config.uptime") AS uptime_seconds\
max(_time) AS last_report\
from datamodel=NMON_Config where (nodename = Nmon_Config) groupby "Nmon_Config.hostname", "Nmon_Config.OStype" prestats=true\
| stats dedup_splitvals=t\
latest("Nmon_Config.AIX_Machine_SerialNumber") AS AIX_Machine_SerialNumber\
latest("Nmon_Config.AIX_virtualcpus") AS AIX_virtualcpus\
latest("Nmon_Config.AIX_logicalcores") AS AIX_logicalcores\
latest("Nmon_Config.AIX_entitled") AS AIX_entitled\
latest("Nmon_Config.AIX_LEVEL") AS AIX_LEVEL\
latest("Nmon_Config.AIX_processor_mode") AS AIX_processor_mode\
latest("Nmon_Config.AIX_processor_clockspeed") AS AIX_processor_clockspeed\
latest("Nmon_Config.AIX_cpu_type") AS AIX_cpu_type\
latest("Nmon_Config.AIX_kernel_type") AS AIX_kernel_type\
latest("Nmon_Config.AIX_plateform_firmware_level") AS AIX_plateform_firmware_level\
latest("Nmon_Config.AIX_PoolID") AS AIX_PoolID\
latest("Nmon_Config.AIX_system_installed_CPUs") AS AIX_system_installed_CPUs\
latest("Nmon_Config.AIX_system_active_CPUs") AS AIX_system_active_CPUs\
latest("Nmon_Config.AIX_PoolCPUs") AS AIX_PoolCPUs\
latest("Nmon_Config.Linux_memory_MB") AS Linux_memory_MB\
latest("Nmon_Config.Linux_swap_MB") AS Linux_swap_MB\
latest("Nmon_Config.Linux_distribution") AS Linux_distribution\
latest("Nmon_Config.Linux_vendor") AS Linux_vendor\
latest("Nmon_Config.Linux_kernelversion") AS Linux_kernelversion\
latest("Nmon_Config.Solaris_version") AS Solaris_version\
latest("Nmon_Config.Solaris_sunOS_version") AS Solaris_sunOS_version\
latest("Nmon_Config.Solaris_processor_clockspeed") AS Solaris_processor_clockspeed\
latest("Nmon_Config.Processor") AS Processor\
latest("Nmon_Config.cpu_cores") AS cpu_cores\
latest("Nmon_Config.nmon_version") AS nmon_version\
latest("Nmon_Config.uptime") AS uptime_seconds\
max(_time) AS last_report by "Nmon_Config.hostname", "Nmon_Config.OStype"\
| sort limit=0 "Nmon_Config.hostname"\
| fields - _span\
| rename "Nmon_Config.hostname" AS hostname "Nmon_Config.OStype" AS OStype\
| eval now=now()\
| eval uptime_seconds=(uptime_seconds+(now-last_report))\
| eval uptime_duration=tostring(uptime_seconds, "duration")\
| eval reporting_date=strftime(last_report, "%m/%d/%Y %H:%M")\
| eval system_startup_date=strftime((now()-uptime_seconds), "%m/%d/%Y %H:%M")\
| fields hostname, OStype, AIX_Machine_SerialNumber, AIX_virtualcpus, AIX_logicalcores, AIX_entitled, AIX_LEVEL,\
AIX_processor_mode, AIX_processor_clockspeed, AIX_cpu_type, AIX_kernel_type, AIX_plateform_firmware_level, AIX_PoolID,\
AIX_system_installed_CPUs, AIX_system_active_CPUs, AIX_PoolCPUs, Linux_memory_MB, Linux_swap_MB, Linux_distribution,\
Linux_vendor, Linux_kernelversion, Solaris_version, Solaris_sunOS_version, Solaris_processor_clockspeed, Processor, cpu_cores, nmon_version, uptime_seconds, uptime_duration, system_startup_date, reporting_date\
| eval AIX_logicalcores=case(OStype=="Linux", "", OStype=="Solaris", "", OStype="AIX", AIX_logicalcores)\
| outputlookup nmon_inventory

#############################################################
# NMON Baseline
#############################################################

# These reports will generate the Nmon baseline and store results in nmon_baseline KV Store collections
# By default, schedules runs every sunday starting at midnight

[Generate NMON Baseline KV Collection for CPU_ALL]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 0 * * 0
dispatch.earliest_time = -3mon@d
dispatch.latest_time = @d
dispatch.ttl = 3600 # Keep 1 hour this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.enablePreview = 0
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 563
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 60
search = | tstats avg("CPU.cpu_PCT") AS cpu_PCT from datamodel=NMON_Data_CPU where (nodename = CPU.CPU_ALL) groupby _time, "CPU.frameID", "CPU.hostname" prestats=true span=5m\
| bucket _time span=5m\
| stats dedup_splitvals=t avg("CPU.cpu_PCT") AS cpu_PCT by _time, "CPU.frameID", "CPU.hostname"\
| rename "CPU.frameID" AS "frameID" "CPU.hostname" AS hostname\
| fields _time, frameID, hostname, cpu_PCT\
| where isnotnull(cpu_PCT)\
| eval date_wday=lower(strftime('_time', "%A"))\
| eval local_time=strftime('_time', "%H%M")\
| stats\
perc05(cpu_PCT) AS lower_baseline_avg_cpu, avg(cpu_PCT) AS baseline_avg_cpu, perc95(cpu_PCT) AS upper_baseline_avg_cpu\
by date_wday,local_time,frameID,hostname\
| foreach *baseline* [ eval <<FIELD>> = round(<<FIELD>>, 2) ]\
| eval ID=frameID + "_" + hostname + "_" + date_wday + "_" + local_time | table ID, date_wday, local_time, frameID, hostname, *\
| eval _key=ID\
| outputlookup nmon_baseline_CPU_ALL

[Generate NMON Baseline KV Collection for LPAR]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 1 * * 0
dispatch.earliest_time = -3mon@d
dispatch.latest_time = @d
dispatch.ttl = 3600 # Keep 1 hour this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.enablePreview = 0
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 563
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 60
search = | tstats avg("CPU.lpar_vp_usage") AS lpar_vp_usage avg("CPU.LPAR.Pool_usage") AS Pool_usage from datamodel=NMON_Data_CPU where (nodename = CPU) groupby _time, "CPU.frameID", "CPU.hostname" prestats=true span=5m\
| bucket _time span=5m\
| stats dedup_splitvals=t avg("CPU.lpar_vp_usage") AS lpar_vp_usage avg("CPU.LPAR.Pool_usage") AS Pool_usage by _time, "CPU.frameID", "CPU.hostname"\
| rename "CPU.frameID" AS frameID "CPU.hostname" AS hostname\
| fields _time, frameID, hostname, lpar_vp_usage, Pool_usage\
| where isnotnull(lpar_vp_usage)\
| eval date_wday=lower(strftime('_time', "%A"))\
| eval local_time=strftime('_time', "%H%M")\
| stats\
perc05(lpar_vp_usage) AS lower_baseline_avg_vp_usage, avg(lpar_vp_usage) AS baseline_avg_vp_usage, perc95(lpar_vp_usage) AS upper_baseline_avg_vp_usage,\
perc05(Pool_usage) AS lower_baseline_avg_pool_usage, avg(Pool_usage) AS baseline_avg_pool_usage, perc95(Pool_usage) AS upper_baseline_avg_pool_usage,\
by date_wday,local_time,frameID,hostname\
| foreach *baseline* [ eval <<FIELD>> = round(<<FIELD>>, 2) ] \
| eval ID=frameID + "_" + hostname + "_" + date_wday + "_" + local_time | fields ID, date_wday, local_time, frameID, hostname, *\
| eval _key=ID\
| outputlookup nmon_baseline_LPAR

[Generate NMON Baseline KV Collection for MEM]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 2 * * 0
dispatch.earliest_time = -3mon@d
dispatch.latest_time = @d
dispatch.ttl = 3600 # Keep 1 hour this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.enablePreview = 0
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 563
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 60
search = | tstats avg("MEM.allOS_Real_used_PCT") AS allOS_Real_used_PCT avg("MEM.allOS_Virtual_used_PCT") AS allOS_Virtual_used_PCT from datamodel=NMON_Data_MEM where (nodename = MEM) groupby _time, "MEM.frameID", "MEM.hostname" prestats=true span=5m\
| bucket _time span=5m\
| stats dedup_splitvals=t avg("MEM.allOS_Real_used_PCT") AS allOS_Real_used_PCT avg("MEM.allOS_Virtual_used_PCT") AS allOS_Virtual_used_PCT by _time, "MEM.frameID", "MEM.hostname"\
| rename "MEM.frameID" AS frameID "MEM.hostname" AS hostname\
| fields _time, frameID, hostname, allOS_Real_used_PCT, allOS_Virtual_used_PCT\
| where isnotnull(allOS_Real_used_PCT)\
| eval date_wday=lower(strftime('_time', "%A"))\
| eval local_time=strftime('_time', "%H%M")\
| stats\
perc05(allOS_Real_used_PCT) AS lower_baseline_avg_real_mem, avg(allOS_Real_used_PCT) AS baseline_avg_real_mem, perc95(allOS_Real_used_PCT) AS upper_baseline_avg_real_mem,\
perc05(allOS_Virtual_used_PCT) AS lower_baseline_avg_virtual_mem, avg(allOS_Virtual_used_PCT) AS baseline_avg_virtual_mem, perc95(allOS_Virtual_used_PCT) AS upper_baseline_avg_virtual_mem,\
by date_wday,local_time,frameID,hostname\
| foreach *baseline* [ eval <<FIELD>> = round(<<FIELD>>, 2) ]\
| outputlookup nmon_baseline_MEM

[Generate NMON Baseline KV Collection for DISKXFER]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
cron_schedule = 0 3 * * 0
dispatch.earliest_time = -3mon@d
dispatch.latest_time = @d
dispatch.ttl = 3600 # Keep 1 hour this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.enablePreview = 0
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 563
display.visualizations.charting.chart = line
display.visualizations.show = 0
enableSched = 1
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 60
search = | tstats sum("DISKXFER.value") AS value from datamodel=NMON_Data_DISKXFER where (nodename = DISKXFER) groupby _time, "DISKXFER.frameID", "DISKXFER.hostname" prestats=true span=1s\
| bucket _time span=1s\
| stats dedup_splitvals=t sum("DISKXFER.value") AS value by _time "DISKXFER.frameID", "DISKXFER.hostname"\
| rename "DISKXFER.frameID" AS frameID "DISKXFER.hostname" AS hostname\
| fields _time, frameID, hostname, value\
| bucket _time span=5m\
| stats avg(value) AS value by _time, frameID, hostname\
| where isnotnull(value)\
| eval date_wday=lower(strftime('_time', "%A"))\
| eval local_time=strftime('_time', "%H%M")\
| stats perc05(value) AS lower_baseline_avg_disk_iops, avg(value) AS baseline_avg_disk_iops, perc95(value) AS upper_baseline_avg_disk_iops by date_wday,local_time,frameID,hostname\
| foreach *baseline* [ eval <<FIELD>> = round(<<FIELD>>, 2) ]\
| eval ID=frameID + "_" + hostname + "_" + date_wday + "_" + local_time | fields ID, date_wday, local_time, frameID, hostname, *\
| eval _key=ID\
| outputlookup nmon_baseline_DISKXFER

####################################################################
# NMON Processing Errors: Number of errors reported in last 24 hours
####################################################################

[Number of Errors in Data Processing or Data Collect since last 24 Hours]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.digest_mode = True
alert.suppress = 0
alert.track = 0
auto_summarize = 1
auto_summarize.dispatch.earliest_time = -1d@h
dispatch.earliest_time = -24h
dispatch.latest_time = now
dispatch.ttl = 600 # Keep 10m this job artifact
display.general.type = statistics
display.page.search.mode = fast
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = (eventtype=nmon:processing OR eventtype=nmon:collect error) OR (index=_internal sourcetype=splunkd ERROR ExecProcessor nmon) NOT ("There is no python in" OR "python: not found") | stats count As trend1\
| appendcols\
[ search (eventtype=nmon:processing OR eventtype=nmon:collect error) OR (index=_internal sourcetype=splunkd ERROR ExecProcessor nmon) NOT ("There is no python in" OR "python: not found") earliest="-1d@d" latest="@d" | stats count As trend2 ]\
| transpose | fields row* | rename "row 1" As value

#############################################################
# NMON Processing Errors
#############################################################

[Errors in NMON Data Processing]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = eventtype=nmon:processing error

#############################################################
# NMON Collect Errors
#############################################################

[Errors in NMON Data Collect]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = eventtype=nmon:collect error

#############################################################
# NMON Collect Activity
#############################################################

[Activity of NMON Data Collect]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.general.type = statistics
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = eventtype=nmon:collect | table _time,host,_raw | rename _raw as event

#############################################################
# NMON Processing Activity
#############################################################

[Activity of NMON Data Processing]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.general.type = statistics
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = eventtype=nmon:processing | stats values(hostname) As "hostname (Nmon host)", values(_raw) As event by _time,host | rename host As "host (collecter)" | sort - _time

#############################################################
# NMON Activity - Splunkd events
#############################################################

[Activity of NMON - Splunkd events]
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_internal sourcetype=splunkd nmon *Processor

#############################################################
# NMON Report Inventory
#############################################################

[NMON Inventory Solaris]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.general.type = statistics
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = | inputlookup nmon_inventory | search OStype=Solaris\
| fields hostname,OStype,Solaris_sunOS_version,Solaris_version,cpu_cores,Processor,Solaris_processor_clockspeed,nmon_version

[NMON Inventory Linux]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.general.type = statistics
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = | inputlookup nmon_inventory | search OStype=Linux\
| fields hostname,OStype,cpu_cores,Processor,Linux_memory_MB,Linux_swap_MB,Linux_distribution,Linux_kernelversion,nmon_version,uptime_seconds,uptime_duration,system_startup_date

[NMON Inventory AIX]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
display.events.fields = ["host","source","sourcetype","hostname"]
display.events.type = raw
display.general.type = statistics
display.statistics.drilldown = none
display.statistics.rowNumbers = 1
display.visualizations.chartHeight = 420
display.visualizations.charting.chart = line
display.visualizations.charting.chart.style = minimal
display.visualizations.show = 0
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = | inputlookup nmon_inventory | search OStype=AIX\
| fields  hostname,OStype,AIX_Machine_SerialNumber,AIX_virtualcpus,AIX_logicalcores,AIX_entitled,Processor,AIX_processor_mode,AIX_processor_clockspeed,AIX_cpu_type,AIX_kernel_type,AIX_plateform_firmware_level,nmon_version,AIX_PoolID,AIX_system_installed_CPUs,AIX_system_active_CPUs,AIX_PoolCPUs

#############################################################
# NMON Alerting
#############################################################

[NMON - File System % usage exceeds 90% (5 consecutive minutes minimal duration)]
action.email = 0
action.email.include.trigger_time = 1
action.email.inline = 1
action.email.priority = 2
action.email.reportServerEnabled = 0
action.email.sendresults = 0
action.email.useNSSubject = 1
alert.digest_mode = 0
alert.severity = 4
alert.suppress = 1
alert.suppress.fields = frameID,hostname
alert.suppress.period = 60m
alert.track = 1
counttype = number of events
cron_schedule = */5 * * * *
description = This alert with trigger hosts having a File System with % global usage superior to 90 %, and for a duration higher or equal to 5 minutes consecutively. (applicable for all OS)
dispatch.earliest_time = -60m
dispatch.latest_time = now
dispatch.ttl = 600 # Keep 10m this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 571
display.visualizations.charting.chart = bar
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 5
search = `alerting_filesystem_usage(*,*,90,300,5m)`

[NMON - Real Memory % usage exceeds 90% (5 consecutive minutes minimal duration)]
action.email = 0
action.email.include.trigger_time = 1
action.email.inline = 1
action.email.priority = 2
action.email.reportServerEnabled = 0
action.email.sendresults = 0
action.email.useNSSubject = 1
alert.digest_mode = 0
alert.severity = 4
alert.suppress = 1
alert.suppress.fields = frameID,hostname
alert.suppress.period = 60m
alert.track = 1
counttype = number of events
cron_schedule = */5 * * * *
description = This alert with trigger hosts having a Real Memory % global usage superior to 90 %, and for a duration higher or equal to 5 minutes consecutively. (applicable for all OS)
dispatch.earliest_time = -60m
dispatch.latest_time = now
dispatch.ttl = 600 # Keep 10m this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 571
display.visualizations.charting.chart = bar
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 5
search = `alerting_realmemory_usage(*,*,90,300,5m)`

[NMON - Virtual Memory % usage exceeds 40% (5 consecutive minutes minimal duration)]
action.email = 0
action.email.include.trigger_time = 1
action.email.inline = 1
action.email.priority = 2
action.email.reportServerEnabled = 0
action.email.sendresults = 0
action.email.useNSSubject = 1
alert.digest_mode = 0
alert.severity = 4
alert.suppress = 1
alert.suppress.fields = frameID,hostname
alert.suppress.period = 60m
alert.track = 1
counttype = number of events
cron_schedule = 1-59/5 * * * *
description = This alert with trigger hosts having a Virtual Memory % global usage superior to 40 %, and for a duration higher or equal to 5 minutes consecutively. (applicable for all OS)
dispatch.earliest_time = -60m
dispatch.latest_time = now
dispatch.ttl = 600 # Keep 10m this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 571
display.visualizations.charting.chart = bar
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 5
search = `alerting_virtualmemory_usage(*,*,40,300,5m)`

[NMON - IBM PSERIES Pools CPU % usage exceeds 90% (5 consecutive minutes minimal duration)]
action.email = 0
action.email.include.trigger_time = 1
action.email.inline = 1
action.email.priority = 2
action.email.reportServerEnabled = 0
action.email.sendresults = 0
action.email.useNSSubject = 1
alert.digest_mode = 0
alert.severity = 4
alert.suppress = 1
alert.suppress.fields = frameID,Pool_id
alert.suppress.period = 60m
alert.track = 1
counttype = number of events
cron_schedule = 1-59/5 * * * *
description = This alert with trigger IBM PSeries Pools having a CPU % global usage superior to 90 %, and for a duration higher or equal to 5 minutes consecutively.\
(applicable for AIX only)
dispatch.earliest_time = -60m
dispatch.latest_time = now
dispatch.ttl = 600 # Keep 10m this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 571
display.visualizations.charting.chart = bar
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 5
search = `alerting_PSERIES_pools_cpu_usage(*,*,*,90,300,5m)`

[NMON - CPU % usage exceeds 90% (5 consecutive minutes minimal duration)]
action.email = 0
action.email.include.trigger_time = 1
action.email.inline = 1
action.email.priority = 2
action.email.reportServerEnabled = 0
action.email.sendresults = 0
action.email.useNSSubject = 1
alert.digest_mode = 0
alert.severity = 4
alert.suppress = 1
alert.suppress.fields = frameID,hostname
alert.suppress.period = 60m
alert.track = 1
counttype = number of events
cron_schedule = 2-59/5 * * * *
dispatch.ttl = 600 # Keep 10m this job artifact
description = This alert with trigger hosts having a CPU % global usage superior to 90 %, and for a duration higher or equal to 5 minutes consecutively.\
If the LPAR data is not null (eg. AIX hosts running PSeries), then this section will used.\
In the contrary, the CPU_ALL section will used to identify the CPU % usage (applicable for all OS)
dispatch.earliest_time = -60m
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 571
display.visualizations.charting.chart = bar
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 5
search = `alerting_cpu_usage(*,*,90,300,5m)`

[NMON Collect - duplicated nmon instances may occur (excessive nbr of process launched)]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.digest_mode = 0
alert.severity = 4
alert.suppress = 1
alert.suppress.fields = host
alert.suppress.period = 60m
alert.track = 1
counttype = number of events
cron_schedule = 2-59/5 * * * *
description = This alert will trigger if it is detected that nmon instances were automatically launched too quickly.\
\
This may indicate a potential issue resulting in duplicating nmon instances on the host, which generates duplicated events, useless CPU load and licence cost
dispatch.earliest_time = -60m
dispatch.latest_time = now
dispatch.ttl = 600 # Keep 10m this job artifact
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.visualizations.chartHeight = 571
enableSched = 1
quantity = 0
relation = greater than
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
schedule_window = 5
search = eventtype=nmon:collect "starting nmon" | transaction host maxpause=3m | where duration!=0

#############################################################
# TA-NMON Agent Reporting
#############################################################

[TA-nmon package deployment reporting (requires _internal access)]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -30d@d
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.visualizations.chartHeight = 577
display.visualizations.show = 0
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_internal sourcetype=splunkd "DeployedApplication - Installing app=*nmon*"

[List of interpreter and interpreter versions per host]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -30d@d
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 577
display.visualizations.show = 0
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = | pivot NMON_Processing_Data_Collect NMON_Processing last(converter_inuse) AS "Type of coverter in use (last known value)" last(interpreter_version) AS "Version of Interpreter (last known value)" SPLITROW _time AS _time\
PERIOD minute SPLITROW hostname AS hostname SORT 0 _time ROWSUMMARY 0 COLSUMMARY 0 NUMCOLS 0 SHOWOTHER 1 | dedup hostname "Type of coverter in use (last known value)" "Version of Interpreter (last known value)" | fields - _time

[TA-nmon package deployment reporting over time (requires _internal access)]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -30d@d
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 577
display.visualizations.charting.chart.overlayFields = Nbr_of_deployment_actions
display.visualizations.charting.legend.placement = top
display.visualizations.show = 0
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_internal sourcetype=splunkd "DeployedApplication - Installing app=*nmon*" | timechart span=1d dc(host) AS Number_hosts_deployed count AS Nbr_of_deployment_actions

[Universal Forwarders Configuration Report]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -30d@d
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 534
display.visualizations.show = 0
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_internal source=*metrics.log group=tcpin_connections version=* | eval hostname=if(isnull(hostname), sourceHost,hostname)\
| stats latest(sourceIp) AS sourceIp, latest(os) AS os, latest(version) AS version, latest(fwdType) AS fwdType, latest(arch) AS arch by hostname

################
#	SAFE CENTER #
################

#### CPU ####

[SAFE CENTER - Number of active CPU alerts]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -60m
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = CPU active alerts
display.visualizations.singlevalue.underLabel = 5m CPU % saturation over 90%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_audit action=alert_fired action=alert_fired ss_name="NMON - CPU % usage exceeds 90% (5 consecutive minutes minimal duration)" ss_app="nmon" earliest="-60m" latest="now" | stats count AS count | rangemap field=count low=0-0 default=high

[SAFE CENTER - CPU issues]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = Host(s) with Potential CPU issue
display.visualizations.singlevalue.underLabel = 5m CPU % saturation over 90%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = `alerting_cpu_usage(*,*,90,300,5m)`

[SAFE CENTER - Number of active Real Memory alerts]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -60m
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = Memory active alerts
display.visualizations.singlevalue.underLabel = 5m Real Memory % saturation over 90%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_audit action=alert_fired action=alert_fired ss_name="NMON - Real Memory % usage exceeds 90% (5 consecutive minutes minimal duration)" ss_app="nmon" earliest="-60m" latest="now" | stats count AS count | rangemap field=count low=0-0 default=high

[SAFE CENTER - Real Memory issues]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = Host(s) with Potential Memory issue
display.visualizations.singlevalue.underLabel = 5m Real Memory % saturation over 90%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = `alerting_realmemory_usage(*,*,90,300,5m)`

[SAFE CENTER - Number of active Virtual Memory alerts]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = Virtual Memory active alerts
display.visualizations.singlevalue.underLabel = 5m Virtual Memory % saturation over 40%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_audit action=alert_fired action=alert_fired ss_name="NMON - Virtual Memory % usage exceeds 40% (5 consecutive minutes minimal duration)" ss_app="nmon" earliest="-60m" latest="now" | stats count AS count | rangemap field=count low=0-0 default=high

[SAFE CENTER - Virtual Memory issues]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = Host(s) with Potential Virtual Memory issue
display.visualizations.singlevalue.underLabel = 5m Virtual Memory % saturation over 40%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = `alerting_virtualmemory_usage(*,*,40,300,5m)`

[SAFE CENTER - Number of active FS alerts]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -60m
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = FileSystem active alerts
display.visualizations.singlevalue.underLabel = 5m FS % usage saturation over 90%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = index=_audit action=alert_fired action=alert_fired ss_name="NMON - File System % usage exceeds 90% (5 consecutive minutes minimal duration)" ss_app="nmon" earliest="-60m" latest="now" | stats count AS count | rangemap field=count low=0-0 default=high

[SAFE CENTER - FS issues]
action.email.reportServerEnabled = 0
action.email.useNSSubject = 1
alert.track = 0
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = visualizations
display.page.search.tab = visualizations
display.visualizations.chartHeight = 534
display.visualizations.charting.chart = line
display.visualizations.singlevalue.afterLabel = Host(s) with FS usage in excess
display.visualizations.singlevalue.underLabel = 5m FS % usage saturation over 90%
display.visualizations.type = singlevalue
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = `alerting_filesystem_usage(*,*,90,300,5m)`

#######################
#	Various Reports   #
#######################

[Linux OS - Last known uptime by host]
action.email.useNSSubject = 1
alert.track = 0
description = This report shows last known uptime for Linux host based on inventory data
dispatch.earliest_time = -24h
dispatch.latest_time = now
display.events.fields = ["host","hostname","type","source","sourcetype"]
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.chartHeight = 606
display.visualizations.show = 0
request.ui_dispatch_app = nmon
request.ui_dispatch_view = search
search = | pivot NMON_Config Nmon_Config latest(uptime) AS last_known_uptime FILTER uptime is "*" SPLITROW _time AS _time PERIOD auto SPLITROW host AS host SORT 0 _time ROWSUMMARY 0 COLSUMMARY 0 NUMCOLS 0 SHOWOTHER 1\
| eval epoch=strftime(_time, "%s") | sort - epoch | dedup host\
| eval reporting_date=strftime(epoch, "%m/%d/%Y %H:%M")\
| eval now=now()\
| eval last_known_uptime=(last_known_uptime+(now-epoch))\
| sort host\
| eval "Date of last system startup (mm/dd/Y HH:MM)"=strftime((now()-last_known_uptime), "%m/%d/%Y %H:%M")\
| eval "uptime (human duration)"=tostring(last_known_uptime, "duration")\
| fields host,last_known_uptime,"uptime (human duration)","Date of last system startup (mm/dd/Y HH:MM)",reporting_date | fields - _time\
| rename last_known_uptime AS "uptime (in seconds)", reporting_date AS "Last reporting date (mm/dd/Y HH:MM)"
