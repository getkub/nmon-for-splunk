<form stylesheet="ui_simple.css,hover.css,hide_timeindicator.css,panel_decoration.css" script="active_button.js,autodiscover.js">
    <label>Bullet Dashboard - TOP servers by CPU/Memory, TOP Processes by CPU</label>
    <fieldset autoRun="false" submitButton="false">

        <input type="time" token="timerange" searchWhenChanged="true">
            <label>Time Range:</label>
            <default>
                <earliestTime>-4h</earliestTime>
                <latestTime>now</latestTime>
            </default>
            <!--
            Reset the form token changed
            -->
       		<change>
         		<unset token="drilldown_cpuhost"></unset>
                <unset token="drilldown_memhost"></unset>
                <unset token="drilldown_swaphost"></unset>
       		</change>
        </input>

        <input type="dropdown" token="timefilter" searchWhenChanged="true">
            <label>Time Filtering:</label>
            <choice value="No_Filter">No Filter (24/24, 7/7)</choice>
            <choice value="Day_BusinessDays_8h-19h">Day Business (08h-19h)</choice>
            <choice value="Day_WeekEnd_8h-19h">Day WE (08h-19h)</choice>
            <choice value="Day_AllDays_8h-19h">Day Week (08h-19h)</choice>
            <choice value="Night_BusinessDays_19h-8h">Night Business (19h-08h)</choice>
            <choice value="Night_WeekEnd_19h-8h">Night WE (19h-08h)</choice>
            <choice value="Night_AllDays_19h-8h">Night All Days (19h-08h)</choice>
            <default>No_Filter</default>
        </input>

        <input type="dropdown" token="osfilter" searchWhenChanged="true">
            <label>Filter OS Type:</label>
            <default>*</default>
            <prefix>"</prefix>
            <suffix>"</suffix>
            <choice value="*">Any OS</choice>
            <choice value="AIX">AIX</choice>
            <choice value="Linux">Linux</choice>
            <choice value="Solaris">Solaris</choice>
            <!--
            Reset the form token changed
            -->
       		<change>
         		<unset token="drilldown_cpuhost"></unset>
                <unset token="drilldown_memhost"></unset>
                <unset token="drilldown_swaphost"></unset>
       		</change>
        </input>

        <input type="multiselect" token="frameID" searchWhenChanged="true">
            <label>Frame IDs:</label>
            <!-- Populating Data Model Search -->
            <search id="frameIDSearch">
                <query>| tstats count AS Count from datamodel=NMON_Data_CPU where (nodename = CPU) ($osfilter$) groupby "CPU.frameID" prestats=true
| stats dedup_splitvals=t count AS Count by "CPU.frameID"
| sort limit=0 "CPU.frameID"
| fields - _span | fillnull Count | fields "CPU.frameID"</query>
                <earliest>$timerange.earliest$</earliest>
                <latest>$timerange.latest$</latest>
            </search>
            <valuePrefix>"</valuePrefix>
            <valueSuffix>"</valueSuffix>
            <delimiter> OR </delimiter>
            <choice value="*">Any</choice>
            <default>*</default>
            <fieldForLabel>CPU.frameID</fieldForLabel>
            <fieldForValue>CPU.frameID</fieldForValue>
            <!--
            Reset the form token changed
            -->
       		<change>
         		<unset token="drilldown_cpuhost"></unset>
                <unset token="drilldown_memhost"></unset>
                <unset token="drilldown_swaphost"></unset>
       		</change>
        </input>

        <input type="text" token="hostname-prefilter" searchWhenChanged="true">
            <label>Optional: Filter hosts populating</label>
            <default>*</default>
            <!--
            Reset the form token changed
            -->
       		<change>
         		<unset token="drilldown_cpuhost"></unset>
                <unset token="drilldown_memhost"></unset>
                <unset token="drilldown_swaphost"></unset>
       		</change>
        </input>

        <input type="multiselect" token="hostname" searchWhenChanged="true">
            <label>Hosts Selection:</label>
            <!-- Populating Data Model Search -->
            <search id="hostsSearch">
                <query>| tstats count AS Count from datamodel=NMON_Data_CPU where (nodename = CPU) (CPU.hostname=$hostname-prefilter$) ($frameID$) ($osfilter$) groupby "CPU.hostname" prestats=true
| stats dedup_splitvals=t count AS Count by "CPU.hostname"
| sort limit=0 "CPU.hostname"
| fields - _span | fillnull Count | fields "CPU.hostname"</query>
                <earliest>$timerange.earliest$</earliest>
                <latest>$timerange.latest$</latest>
            </search>
            <valuePrefix>"</valuePrefix>
            <valueSuffix>"</valueSuffix>
            <delimiter> OR </delimiter>
            <choice value="*">ALL Hosts</choice>
            <default>*</default>
            <fieldForLabel>CPU.hostname</fieldForLabel>
            <fieldForValue>CPU.hostname</fieldForValue>
            <!--
            Reset the form token changed
            -->
       		<change>
         		<unset token="drilldown_cpuhost"></unset>
                <unset token="drilldown_memhost"></unset>
                <unset token="drilldown_swaphost"></unset>
       		</change>
        </input>

    </fieldset>

    <!-- ############################# CPU stats ############################# -->

    <row>
        <panel>
            <html>
                <div class="dashseparator">
                    <h1>PROCESSOR - TOP servers by CPU / Physical and Virtual memory % utilization - Dynamic drilldown: Click on the server line to see over time statistics</h1>
                </div>
            </html>
        </panel>
    </row>

    <search id="main_cpu">
        <query>| tstats max("CPU.lpar_vp_usage_PCT") AS vp_usage_pct avg("CPU.cpu_PCT") AS pct_usage from datamodel=NMON_Data_CPU where (nodename = CPU) (CPU.hostname=$hostname-prefilter$) (CPU.frameID=$frameID$) (CPU.OStype=$osfilter$) (CPU.hostname=$hostname$) `$timefilter$(CPU)` groupby _time, "CPU.hostname" prestats=true span=1m
| bucket _time span=1m
| stats dedup_splitvals=t max("CPU.lpar_vp_usage_PCT") AS vp_usage_pct avg("CPU.cpu_PCT") AS pct_usage by _time, "CPU.hostname"
| eval usage=if(isnotnull(vp_usage_pct), vp_usage_pct, pct_usage)
| stats max(usage) AS max_usage avg(usage) AS avg_usage median(usage) AS median_usage by "CPU.hostname"
| rename "CPU.hostname" AS host
| foreach *_usage [ eval &lt;&lt;FIELD&gt;&gt;=round('&lt;&lt;FIELD&gt;&gt;', 2) ]</query>
        <earliest>$timerange.earliest$</earliest>
        <latest>$timerange.latest$</latest>
    </search>

    <search id="main_memory">
        <query>| tstats max(MEM.mem_used_effective_PCT) AS mem_used_effective_PCT max(MEM.swap_used_effective_PCT) AS swap_used_effective_PCT from datamodel=NMON_Data_MEM where (nodename = MEM) (MEM.hostname=$hostname-prefilter$) (MEM.frameID=$frameID$) (MEM.OStype=$osfilter$) (MEM.hostname=$hostname$) `$timefilter$(MEM)` groupby _time MEM.hostname prestats=true span=1m
| stats dedup_splitvals=t max(MEM.mem_used_effective_PCT) AS mem_used_effective_PCT max(MEM.swap_used_effective_PCT) AS swap_used_effective_PCT by _time, MEM.hostname
| stats avg(mem_used_effective_PCT) AS mem_usage_pct, avg(swap_used_effective_PCT) AS swap_usage_pct by MEM.hostname
| rename "MEM.hostname" AS host
| foreach *_usage_pct [ eval &lt;&lt;FIELD&gt;&gt;=round('&lt;&lt;FIELD&gt;&gt;', 2) ]</query>
        <earliest>$timerange.earliest$</earliest>
        <latest>$timerange.latest$</latest>
    </search>

    <row>
        <panel>
            <title>TOP 5 hosts by Average CPU percentage usage (%)</title>
            <viz type="nmon.nmon_bullet_graph">
                <search base="main_cpu">
                    <query>sort - avg_usage | head 5 | eval range_low=50,range_med=85,range_high=100,target=100 | table host,avg_usage,range_low,range_med,range_high,target | sort host</query>
                </search>
                <option name="nmon.nmon_bullet_graph.bulletColor">#778899</option>
                <option name="nmon.nmon_bullet_graph.targetMarkerColor">#ff0000</option>
                <option name="nmon.nmon_bullet_graph.rangeLowColor">#77dd77</option>
                <option name="nmon.nmon_bullet_graph.rangeMidColor">#f7bc38</option>
                <option name="nmon.nmon_bullet_graph.rangeHighColor">#FF7878</option>
                <option name="height">300</option>
                <drilldown>
                    <set token="drilldown_cpuhost">$row.host$</set>
                </drilldown>
            </viz>
        </panel>
        <panel>
            <title>TOP 5 hosts by Average physical memory usage (%)</title>
            <viz type="nmon.nmon_bullet_graph">
                <search base="main_memory">
                    <query>sort - mem_usage_pct | head 5 | eval range_low=50,range_med=85,range_high=100,target=100 | table host,mem_usage_pct,range_low,range_med,range_high,target | sort host</query>
                </search>
                <option name="nmon.nmon_bullet_graph.bulletColor">#778899</option>
                <option name="nmon.nmon_bullet_graph.targetMarkerColor">#FF7878</option>
                <option name="nmon.nmon_bullet_graph.rangeLowColor">#77dd77</option>
                <option name="nmon.nmon_bullet_graph.rangeMidColor">#f7bc38</option>
                <option name="nmon.nmon_bullet_graph.rangeHighColor">#FF7878</option>
                <option name="height">300</option>
                <drilldown>
                    <set token="drilldown_memhost">$row.host$</set>
                </drilldown>
            </viz>
        </panel>
        <panel>
            <title>TOP 5 hosts by Average swap memory usage (%)</title>
            <viz type="nmon.nmon_bullet_graph">
                <search base="main_memory">
                    <query>sort - swap_usage_pct | head 5 | eval range_low=50,range_med=85,range_high=100,target=100 | table host,swap_usage_pct,range_low,range_med,range_high,target | sort host</query>
                </search>
                <option name="nmon.nmon_bullet_graph.bulletColor">#778899</option>
                <option name="nmon.nmon_bullet_graph.targetMarkerColor">#FF7878</option>
                <option name="nmon.nmon_bullet_graph.rangeLowColor">#77dd77</option>
                <option name="nmon.nmon_bullet_graph.rangeMidColor">#f7bc38</option>
                <option name="nmon.nmon_bullet_graph.rangeHighColor">#FF7878</option>
                <option name="height">300</option>
                <drilldown>
                    <set token="drilldown_swaphost">$row.host$</set>
                </drilldown>
            </viz>
        </panel>
    </row>

    <row depends="$drilldown_cpuhost$">
        <panel>
            <title>Server $drilldown_cpuhost$ - % CPU utilization over time</title>
            <input type="dropdown" token="span" searchWhenChanged="true">
                <label>Span:</label>
                <default>`inline_customspan`</default>
                <choice value="`inline_customspan`">auto</choice>
                <choice value="span=1m">1 minute</choice>
                <choice value="span=2m">2 minutes</choice>
                <choice value="span=3m">3 minutes</choice>
                <choice value="span=4m">4 minutes</choice>
                <choice value="span=5m">5 minutes</choice>
                <choice value="span=10m">10 minutes</choice>
                <choice value="span=15m">15 minutes</choice>
                <choice value="span=30m">30 minutes</choice>
                <choice value="span=1h">1 hour</choice>
                <choice value="span=2h">2 hours</choice>
                <choice value="span=12h">12 hours</choice>
                <choice value="span=4h">4 hours</choice>
                <choice value="span=1d">1 day</choice>
                <choice value="span=2d">2 days</choice>
                <choice value="span=1w">7 days</choice>
                <choice value="span=1mon">1 month</choice>
            </input>
            <input type="checkbox" token="cpu_scale" searchWhenChanged="true">
                <label></label>
                <default>0</default>
                <choice value="0">Starts scale at 0 %</choice>
            </input>
            <input type="checkbox" token="cpu_scaleend" searchWhenChanged="true">
                <label></label>
                <default>100</default>
                <choice value="100">Ends scale at 100 %</choice>
            </input>
            <input type="dropdown" token="chart" searchWhenChanged="true" depends="$cpu_chart_options$">
                <label>Type of chart:</label>
                <default>line</default>
                <choice value="area">Area</choice>
                <choice value="line">Line</choice>
                <choice value="column">Column</choice>
                <choice value="bar">Bar</choice>
            </input>
            <input type="dropdown" token="charting.chart.nullValueMode" searchWhenChanged="true" depends="$cpu_chart_options$">
                <label>Missing Data:</label>
                <default>gaps</default>
                <choice value="gaps">Gaps</choice>
                <choice value="connect">Connect</choice>
                <choice value="zero">Zero</choice>
            </input>
            <input type="dropdown" token="charting.legend.placement" searchWhenChanged="true" depends="$cpu_chart_options$">
                <label>Legend:</label>
                <default>bottom</default>
                <choice value="bottom">Bottom</choice>
                <choice value="top">Top</choice>
                <choice value="left">left</choice>
                <choice value="right">right</choice>
                <choice value="center">center</choice>
                <choice value="none">none</choice>
            </input>
            <chart>
                <search>
                    <query>| tstats max("CPU.lpar_vp_usage_PCT") AS vp_usage_pct avg("CPU.cpu_PCT") AS pct_usage from datamodel=NMON_Data_CPU where (nodename = CPU) (CPU.hostname=$drilldown_cpuhost$) groupby _time, "CPU.hostname" prestats=true span=1m
| bucket _time span=1m
| stats dedup_splitvals=t max("CPU.lpar_vp_usage_PCT") AS vp_usage_pct avg("CPU.cpu_PCT") AS pct_usage by _time, "CPU.hostname"
| eval usage=if(isnotnull(vp_usage_pct), vp_usage_pct, pct_usage)
| timechart $span$ avg(usage) AS avg_pct_cpu | trendline sma5(avg_pct_cpu) AS trend</query>
                    <earliest>$timerange.earliest$</earliest>
                    <latest>$timerange.latest$</latest>
                </search>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.chart">$chart$</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">unstacked</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.placement">$charting.legend.placement$</option>
                <option name="charting.chart.nullValueMode">$charting.chart.nullValueMode$</option>
                <option name="height">400</option>
                <option name="charting.axisTitleX.text">Time</option>
                <option name="charting.axisTitleY.text">% CPUs</option>
                <option name="charting.axisY.minimumNumber">$cpu_scale$</option>
                <option name="charting.axisY.maximumNumber">$cpu_scaleend$</option>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisY2.enabled">false</option>
                <option name="charting.axisY2.scale">inherit</option>
            </chart>
        </panel>
    </row>

    <row depends="$drilldown_memhost$">
        <panel>
            <title>Server $drilldown_memhost$ - % Physical memory utilization over time</title>
            <input type="dropdown" token="span" searchWhenChanged="true">
                <label>Span:</label>
                <default>`inline_customspan`</default>
                <choice value="`inline_customspan`">auto</choice>
                <choice value="span=1m">1 minute</choice>
                <choice value="span=2m">2 minutes</choice>
                <choice value="span=3m">3 minutes</choice>
                <choice value="span=4m">4 minutes</choice>
                <choice value="span=5m">5 minutes</choice>
                <choice value="span=10m">10 minutes</choice>
                <choice value="span=15m">15 minutes</choice>
                <choice value="span=30m">30 minutes</choice>
                <choice value="span=1h">1 hour</choice>
                <choice value="span=2h">2 hours</choice>
                <choice value="span=12h">12 hours</choice>
                <choice value="span=4h">4 hours</choice>
                <choice value="span=1d">1 day</choice>
                <choice value="span=2d">2 days</choice>
                <choice value="span=1w">7 days</choice>
                <choice value="span=1mon">1 month</choice>
            </input>
            <input type="checkbox" token="mem_scale" searchWhenChanged="true">
                <label></label>
                <default>0</default>
                <choice value="0">Starts scale at 0 %</choice>
            </input>
            <input type="checkbox" token="mem_scaleend" searchWhenChanged="true">
                <label></label>
                <default>100</default>
                <choice value="100">Ends scale at 100 %</choice>
            </input>
            <input type="dropdown" token="chart" searchWhenChanged="true">
                <label>Type of chart:</label>
                <default>line</default>
                <choice value="area">Area</choice>
                <choice value="line">Line</choice>
                <choice value="column">Column</choice>
                <choice value="bar">Bar</choice>
            </input>
            <input type="dropdown" token="charting.chart.nullValueMode" searchWhenChanged="true">
                <label>Missing Data:</label>
                <default>gaps</default>
                <choice value="gaps">Gaps</choice>
                <choice value="connect">Connect</choice>
                <choice value="zero">Zero</choice>
            </input>
            <input type="dropdown" token="charting.legend.placement" searchWhenChanged="true">
                <label>Legend:</label>
                <default>bottom</default>
                <choice value="bottom">Bottom</choice>
                <choice value="top">Top</choice>
                <choice value="left">left</choice>
                <choice value="right">right</choice>
                <choice value="center">center</choice>
                <choice value="none">none</choice>
            </input>
            <chart>
                <search>
        <query>| tstats max(MEM.mem_used_effective_PCT) AS mem_used_effective_PCT from datamodel=NMON_Data_MEM where (nodename = MEM) (MEM.hostname=$drilldown_memhost$) groupby _time MEM.hostname prestats=true span=1m
| stats dedup_splitvals=t max(MEM.mem_used_effective_PCT) AS mem_used_effective_PCT by _time, MEM.hostname
| timechart $span$ avg(mem_used_effective_PCT) AS avg_mem_used_pct | trendline sma5(avg_mem_used_pct) AS trend</query>
                    <earliest>$timerange.earliest$</earliest>
                    <latest>$timerange.latest$</latest>
                </search>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.chart">$chart$</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">unstacked</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.placement">$charting.legend.placement$</option>
                <option name="charting.chart.nullValueMode">$charting.chart.nullValueMode$</option>
                <option name="height">400</option>
                <option name="charting.axisTitleX.text">Time</option>
                <option name="charting.axisTitleY.text">% physical memory</option>
                <option name="charting.axisY.minimumNumber">$mem_scale$</option>
                <option name="charting.axisY.maximumNumber">$mem_scaleend$</option>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisY2.enabled">false</option>
                <option name="charting.axisY2.scale">inherit</option>
            </chart>
        </panel>
    </row>

    <row depends="$drilldown_swaphost$">
        <panel>
            <title>Server $drilldown_swaphost$ - % Virtual memory utilization over time</title>
            <input type="dropdown" token="span" searchWhenChanged="true">
                <label>Span:</label>
                <default>`inline_customspan`</default>
                <choice value="`inline_customspan`">auto</choice>
                <choice value="span=1m">1 minute</choice>
                <choice value="span=2m">2 minutes</choice>
                <choice value="span=3m">3 minutes</choice>
                <choice value="span=4m">4 minutes</choice>
                <choice value="span=5m">5 minutes</choice>
                <choice value="span=10m">10 minutes</choice>
                <choice value="span=15m">15 minutes</choice>
                <choice value="span=30m">30 minutes</choice>
                <choice value="span=1h">1 hour</choice>
                <choice value="span=2h">2 hours</choice>
                <choice value="span=12h">12 hours</choice>
                <choice value="span=4h">4 hours</choice>
                <choice value="span=1d">1 day</choice>
                <choice value="span=2d">2 days</choice>
                <choice value="span=1w">7 days</choice>
                <choice value="span=1mon">1 month</choice>
            </input>
            <input type="checkbox" token="swap_scale" searchWhenChanged="true">
                <label></label>
                <default>0</default>
                <choice value="0">Starts scale at 0 %</choice>
            </input>
            <input type="checkbox" token="swap_scaleend" searchWhenChanged="true">
                <label></label>
                <default>100</default>
                <choice value="100">Ends scale at 100 %</choice>
            </input>
            <input type="dropdown" token="chart" searchWhenChanged="true">
                <label>Type of chart:</label>
                <default>line</default>
                <choice value="area">Area</choice>
                <choice value="line">Line</choice>
                <choice value="column">Column</choice>
                <choice value="bar">Bar</choice>
            </input>
            <input type="dropdown" token="charting.chart.nullValueMode" searchWhenChanged="true">
                <label>Missing Data:</label>
                <default>gaps</default>
                <choice value="gaps">Gaps</choice>
                <choice value="connect">Connect</choice>
                <choice value="zero">Zero</choice>
            </input>
            <input type="dropdown" token="charting.legend.placement" searchWhenChanged="true">
                <label>Legend:</label>
                <default>bottom</default>
                <choice value="bottom">Bottom</choice>
                <choice value="top">Top</choice>
                <choice value="left">left</choice>
                <choice value="right">right</choice>
                <choice value="center">center</choice>
                <choice value="none">none</choice>
            </input>
            <chart>
                <search>
        <query>| tstats max(MEM.swap_used_effective_PCT) AS swap_used_effective_PCT from datamodel=NMON_Data_MEM where (nodename = MEM) (MEM.hostname=$drilldown_swaphost$) groupby _time MEM.hostname prestats=true span=1m
| stats dedup_splitvals=t max(MEM.swap_used_effective_PCT) AS swap_used_effective_PCT by _time, MEM.hostname
| timechart $span$ avg(swap_used_effective_PCT) AS avg_swap_used_pct | trendline sma5(avg_swap_used_pct) AS trend</query>
                    <earliest>$timerange.earliest$</earliest>
                    <latest>$timerange.latest$</latest>
                </search>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.chart">$chart$</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">unstacked</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.placement">$charting.legend.placement$</option>
                <option name="charting.chart.nullValueMode">$charting.chart.nullValueMode$</option>
                <option name="height">400</option>
                <option name="charting.axisTitleX.text">Time</option>
                <option name="charting.axisTitleY.text">% virtual memory</option>
                <option name="charting.axisY.minimumNumber">$swap_scale$</option>
                <option name="charting.axisY.maximumNumber">$swap_scaleend$</option>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisY2.enabled">false</option>
                <option name="charting.axisY2.scale">inherit</option>
            </chart>
        </panel>
    </row>

    <!-- ############################# TOP stats ############################# -->

    <search id="TOPSearch_cpu">
        <query>| tstats max("TOP_ALLOS.pct_CPU") AS pct_CPU from datamodel=NMON_Data_TOP.TOP_ALLOS where (nodename = TOP_ALLOS) (TOP_ALLOS.hostname=$hostname-prefilter$) (TOP_ALLOS.frameID=$frameID$) (TOP_ALLOS.OStype=$osfilter$) (TOP_ALLOS.hostname=$hostname$) `$timefilter$(TOP_ALLOS)` groupby _time, "TOP_ALLOS.frameID", "TOP_ALLOS.hostname", "TOP_ALLOS.logical_cpus", "TOP_ALLOS.Command", "TOP_ALLOS.PID" prestats=true span=1m
| stats dedup_splitvals=t max("TOP_ALLOS.pct_CPU") AS pct_CPU by _time, "TOP_ALLOS.frameID", "TOP_ALLOS.hostname", "TOP_ALLOS.logical_cpus", "TOP_ALLOS.Command", "TOP_ALLOS.PID"
| rename "TOP_ALLOS.frameID" AS frameID, "TOP_ALLOS.hostname" AS hostname "TOP_ALLOS.logical_cpus" AS logical_cpus "TOP_ALLOS.Command" AS Command "TOP_ALLOS.PID" AS PID
| eval limit=(logical_cpus*100)
| where (pct_CPU&lt;=limit)
| dedup _time,frameID,hostname,Command,pct_CPU
| stats sum(pct_CPU) As pct_CPU,last(logical_cpus) As logical_cpus by _time,frameID,hostname,Command
| eval usage_per_core=(pct_CPU/100)
| stats sum(usage_per_core) As value,last(logical_cpus) As logical_cpus by _time,frameID,hostname,Command
| stats sum(value) As value, sum(logical_cpus) As logical_cpus by _time,Command
| eval usage_pct=(value/logical_cpus)*100
| stats max(usage_pct) AS max_usage_pct, avg(usage_pct) AS avg_usage_pct by Command
| sort - avg_usage_pct</query>
        <earliest>$timerange.earliest$</earliest>
        <latest>$timerange.latest$</latest>
    </search>

    <row>
        <panel>
            <html>
                <div class="dashseparator">
                    <h1>PROCESSES - TOP Commands in CPU % utilization - Dynamic drilldown: Click on the Command line to see over time statistics</h1>
                </div>
            </html>
        </panel>
    </row>

    <row>
        <panel>
            <title>TOP 5 Commands by Average CPU usage (% usage by sum of logical CPUs)</title>
            <viz type="nmon.nmon_bullet_graph">
                <search base="TOPSearch_cpu">
                    <query>sort - avg_usage_pct | head 5 | eval range_low=50,range_med=85,range_high=100,target=100 | table Command,avg_usage_pct,range_low,range_med,range_high,target | sort Command</query>
                </search>
                <option name="nmon.nmon_bullet_graph.bulletColor">#778899</option>
                <option name="nmon.nmon_bullet_graph.targetMarkerColor">#FF7878</option>
                <option name="nmon.nmon_bullet_graph.rangeLowColor">#77dd77</option>
                <option name="nmon.nmon_bullet_graph.rangeMidColor">#f7bc38</option>
                <option name="nmon.nmon_bullet_graph.rangeHighColor">#FF7878</option>
                <option name="height">300</option>
                <drilldown>
                    <set token="drilldown_topcpu">$row.Command$</set>
                    <set token="top_statsmode">avg</set>
                    <set token="top_statsmode_label">Average</set>
                </drilldown>
            </viz>
        </panel>
        <panel>
            <title>TOP 5 Commands by Max CPU usage (% usage by sum of logical CPUs)</title>
            <viz type="nmon.nmon_bullet_graph">
                <search base="TOPSearch_cpu">
                    <query>sort - max_usage_pct | head 5 | eval range_low=50,range_med=85,range_high=100,target=100 | table Command,max_usage_pct,range_low,range_med,range_high,target | sort Command</query>
                </search>
                <option name="nmon.nmon_bullet_graph.bulletColor">#778899</option>
                <option name="nmon.nmon_bullet_graph.targetMarkerColor">#FF7878</option>
                <option name="nmon.nmon_bullet_graph.rangeLowColor">#77dd77</option>
                <option name="nmon.nmon_bullet_graph.rangeMidColor">#f7bc38</option>
                <option name="nmon.nmon_bullet_graph.rangeHighColor">#FF7878</option>
                <option name="height">300</option>
                <drilldown>
                    <set token="drilldown_topcpu">$row.Command$</set>
                    <set token="top_statsmode">max</set>
                    <set token="top_statsmode_label">Max</set>
                </drilldown>
            </viz>
        </panel>
    </row>

    <row depends="$drilldown_topcpu$">
        <panel>
            <title>Command $drilldown_topcpu$ - $top_statsmode_label$ % CPU utilization over time</title>
            <input type="dropdown" token="span" searchWhenChanged="true">
                <label>Span:</label>
                <default>`inline_customspan`</default>
                <choice value="`inline_customspan`">auto</choice>
                <choice value="span=1m">1 minute</choice>
                <choice value="span=2m">2 minutes</choice>
                <choice value="span=3m">3 minutes</choice>
                <choice value="span=4m">4 minutes</choice>
                <choice value="span=5m">5 minutes</choice>
                <choice value="span=10m">10 minutes</choice>
                <choice value="span=15m">15 minutes</choice>
                <choice value="span=30m">30 minutes</choice>
                <choice value="span=1h">1 hour</choice>
                <choice value="span=2h">2 hours</choice>
                <choice value="span=12h">12 hours</choice>
                <choice value="span=4h">4 hours</choice>
                <choice value="span=1d">1 day</choice>
                <choice value="span=2d">2 days</choice>
                <choice value="span=1w">7 days</choice>
                <choice value="span=1mon">1 month</choice>
            </input>
            <input type="checkbox" token="top_scale" searchWhenChanged="true">
                <label></label>
                <default>0</default>
                <choice value="0">Starts scale at 0 %</choice>
            </input>
            <input type="checkbox" token="top_scaleend" searchWhenChanged="true">
                <label></label>
                <default>100</default>
                <choice value="100">Ends scale at 100 %</choice>
            </input>
            <input type="dropdown" token="chart" searchWhenChanged="true">
                <label>Type of chart:</label>
                <default>line</default>
                <choice value="area">Area</choice>
                <choice value="line">Line</choice>
                <choice value="column">Column</choice>
                <choice value="bar">Bar</choice>
            </input>
            <input type="dropdown" token="charting.chart.nullValueMode" searchWhenChanged="true">
                <label>Missing Data:</label>
                <default>gaps</default>
                <choice value="gaps">Gaps</choice>
                <choice value="connect">Connect</choice>
                <choice value="zero">Zero</choice>
            </input>
            <input type="dropdown" token="charting.legend.placement" searchWhenChanged="true">
                <label>Legend:</label>
                <default>bottom</default>
                <choice value="bottom">Bottom</choice>
                <choice value="top">Top</choice>
                <choice value="left">left</choice>
                <choice value="right">right</choice>
                <choice value="center">center</choice>
                <choice value="none">none</choice>
            </input>
            <chart>
                <search>
        <query>| tstats max("TOP_ALLOS.pct_CPU") AS pct_CPU from datamodel=NMON_Data_TOP.TOP_ALLOS where (nodename = TOP_ALLOS)
(TOP_ALLOS.Command=$drilldown_topcpu$) (TOP_ALLOS.frameID=$frameID$) (TOP_ALLOS.OStype=$osfilter$) (TOP_ALLOS.hostname=$hostname-prefilter$) (TOP_ALLOS.hostname=$hostname$) `$timefilter$(TOP_ALLOS)` groupby _time, "TOP_ALLOS.frameID", "TOP_ALLOS.hostname", "TOP_ALLOS.logical_cpus", "TOP_ALLOS.Command", "TOP_ALLOS.PID" prestats=true span=1m
| stats dedup_splitvals=t max("TOP_ALLOS.pct_CPU") AS pct_CPU by _time, "TOP_ALLOS.frameID", "TOP_ALLOS.hostname", "TOP_ALLOS.logical_cpus", "TOP_ALLOS.Command", "TOP_ALLOS.PID"
| rename "TOP_ALLOS.frameID" AS frameID, "TOP_ALLOS.hostname" AS hostname "TOP_ALLOS.logical_cpus" AS logical_cpus "TOP_ALLOS.Command" AS Command "TOP_ALLOS.PID" AS PID
| eval limit=(logical_cpus*100)
| where (pct_CPU&lt;=limit)
| dedup _time,frameID,hostname,Command,pct_CPU
| stats sum(pct_CPU) As pct_CPU,last(logical_cpus) As logical_cpus by _time,frameID,hostname,Command
| eval usage_per_core=(pct_CPU/100)
| stats sum(usage_per_core) As value,last(logical_cpus) As logical_cpus by _time,frameID,hostname,Command
| stats sum(value) As value, sum(logical_cpus) As logical_cpus by _time,Command
| eval usage_pct=(value/logical_cpus)*100
| timechart $span$ $top_statsmode$(usage_pct) AS max_usage_pct by Command</query>
                    <earliest>$timerange.earliest$</earliest>
                    <latest>$timerange.latest$</latest>
                </search>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.chart">$chart$</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">unstacked</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.placement">$charting.legend.placement$</option>
                <option name="charting.chart.nullValueMode">$charting.chart.nullValueMode$</option>
                <option name="height">400</option>
                <option name="charting.axisTitleX.text">Time</option>
                <option name="charting.axisTitleY.text">% CPU utilization</option>
                <option name="charting.axisY.minimumNumber">$top_scale$</option>
                <option name="charting.axisY.maximumNumber">$top_scaleend$</option>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisY2.enabled">false</option>
                <option name="charting.axisY2.scale">inherit</option>
            </chart>
        </panel>
    </row>

    <row depends="$drilldown_topcpu$">
        <panel>
            <title>Command $drilldown_topcpu$ - $top_statsmode_label$ % CPU utilization over time by server</title>
            <input type="dropdown" token="span" searchWhenChanged="true">
                <label>Span:</label>
                <default>`inline_customspan`</default>
                <choice value="`inline_customspan`">auto</choice>
                <choice value="span=1m">1 minute</choice>
                <choice value="span=2m">2 minutes</choice>
                <choice value="span=3m">3 minutes</choice>
                <choice value="span=4m">4 minutes</choice>
                <choice value="span=5m">5 minutes</choice>
                <choice value="span=10m">10 minutes</choice>
                <choice value="span=15m">15 minutes</choice>
                <choice value="span=30m">30 minutes</choice>
                <choice value="span=1h">1 hour</choice>
                <choice value="span=2h">2 hours</choice>
                <choice value="span=12h">12 hours</choice>
                <choice value="span=4h">4 hours</choice>
                <choice value="span=1d">1 day</choice>
                <choice value="span=2d">2 days</choice>
                <choice value="span=1w">7 days</choice>
                <choice value="span=1mon">1 month</choice>
            </input>
            <input type="checkbox" token="topserver_scale" searchWhenChanged="true">
                <label></label>
                <default>0</default>
                <choice value="0">Starts scale at 0 %</choice>
            </input>
            <input type="checkbox" token="topserver_scaleend" searchWhenChanged="true">
                <label></label>
                <default>100</default>
                <choice value="100">Ends scale at 100 %</choice>
            </input>
            <input type="dropdown" token="chart" searchWhenChanged="true">
                <label>Type of chart:</label>
                <default>line</default>
                <choice value="area">Area</choice>
                <choice value="line">Line</choice>
                <choice value="column">Column</choice>
                <choice value="bar">Bar</choice>
            </input>
            <input type="dropdown" token="charting.chart.nullValueMode" searchWhenChanged="true">
                <label>Missing Data:</label>
                <default>gaps</default>
                <choice value="gaps">Gaps</choice>
                <choice value="connect">Connect</choice>
                <choice value="zero">Zero</choice>
            </input>
            <input type="dropdown" token="charting.legend.placement" searchWhenChanged="true">
                <label>Legend:</label>
                <default>bottom</default>
                <choice value="bottom">Bottom</choice>
                <choice value="top">Top</choice>
                <choice value="left">left</choice>
                <choice value="right">right</choice>
                <choice value="center">center</choice>
                <choice value="none">none</choice>
            </input>
            <chart>
                <search>
        <query>| tstats max("TOP_ALLOS.pct_CPU") AS pct_CPU from datamodel=NMON_Data_TOP.TOP_ALLOS where (nodename = TOP_ALLOS)
(TOP_ALLOS.Command=$drilldown_topcpu$) (TOP_ALLOS.frameID=$frameID$) (TOP_ALLOS.OStype=$osfilter$) (TOP_ALLOS.hostname=$hostname-prefilter$) (TOP_ALLOS.hostname=$hostname$) `$timefilter$(TOP_ALLOS)` groupby _time, "TOP_ALLOS.frameID", "TOP_ALLOS.hostname", "TOP_ALLOS.logical_cpus", "TOP_ALLOS.Command", "TOP_ALLOS.PID" prestats=true span=1m
| stats dedup_splitvals=t max("TOP_ALLOS.pct_CPU") AS pct_CPU by _time, "TOP_ALLOS.frameID", "TOP_ALLOS.hostname", "TOP_ALLOS.logical_cpus", "TOP_ALLOS.Command", "TOP_ALLOS.PID"
| rename "TOP_ALLOS.frameID" AS frameID, "TOP_ALLOS.hostname" AS hostname "TOP_ALLOS.logical_cpus" AS logical_cpus "TOP_ALLOS.Command" AS Command "TOP_ALLOS.PID" AS PID
| eval limit=(logical_cpus*100)
| where (pct_CPU&lt;=limit)
| dedup _time,frameID,hostname,Command,pct_CPU
| stats sum(pct_CPU) As pct_CPU,last(logical_cpus) As logical_cpus by _time,frameID,hostname,Command
| eval usage_per_core=(pct_CPU/100)
| stats sum(usage_per_core) As value,last(logical_cpus) As logical_cpus by _time,frameID,hostname,Command
| stats sum(value) As value, sum(logical_cpus) As logical_cpus by _time,hostname,Command
| eval usage_pct=(value/logical_cpus)*100
| eval key=hostname+":"+Command
| timechart $span$ $top_statsmode$(usage_pct) AS max_usage_pct by key</query>
                    <earliest>$timerange.earliest$</earliest>
                    <latest>$timerange.latest$</latest>
                </search>
                <option name="charting.axisTitleX.visibility">visible</option>
                <option name="charting.axisTitleY.visibility">visible</option>
                <option name="charting.axisX.scale">linear</option>
                <option name="charting.axisY.scale">linear</option>
                <option name="charting.chart">$chart$</option>
                <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
                <option name="charting.chart.stackMode">unstacked</option>
                <option name="charting.chart.style">shiny</option>
                <option name="charting.drilldown">all</option>
                <option name="charting.layout.splitSeries">0</option>
                <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
                <option name="charting.legend.placement">$charting.legend.placement$</option>
                <option name="charting.chart.nullValueMode">$charting.chart.nullValueMode$</option>
                <option name="height">400</option>
                <option name="charting.axisTitleX.text">Time</option>
                <option name="charting.axisTitleY.text">% CPU utilization</option>
                <option name="charting.axisY.minimumNumber">$topserver_scale$</option>
                <option name="charting.axisY.maximumNumber">$topserver_scaleend$</option>
                <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
                <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
                <option name="charting.axisTitleY2.visibility">visible</option>
                <option name="charting.axisY2.enabled">false</option>
                <option name="charting.axisY2.scale">inherit</option>
            </chart>
        </panel>
    </row>



</form>